- name: Обновить номер билета в index.html
  run: |
    # Проверяем существование файла ticket_data.json
    if [ ! -f "ticket_data.json" ]; then
      echo "Файл ticket_data.json не существует. Создаем резервные данные."
      python -c "
import json
from datetime import datetime
backup_data = {
    'ticket_number': 'BACKUP-987654',
    'valid_from': '01.11.2025 - 00:00',
    'valid_until': '01.12.2025 - 03:00',
    'region': 'Deutschlandweit',
    'class': '2. Klasse',
    'price_level': 'deutschlandweit',
    'last_updated': datetime.now().strftime('%d.%m.%Y %H:%M:%S')
}
with open('ticket_data.json', 'w') as f:
    json.dump(backup_data, f, ensure_ascii=False, indent=2)
      "
    fi
    
    # Обновляем HTML
    python -c "
import json
from bs4 import BeautifulSoup

# Читаем данные билета
with open('ticket_data.json', 'r') as f:
    ticket_data = json.load(f)

# Читаем содержимое index.html
with open('index.html', 'r', encoding='utf-8') as f:
    html_content = f.read()

# Обновляем данные в HTML
soup = BeautifulSoup(html_content, 'html.parser')

# Обновляем номер билета
ticket_number_el = soup.find(id='ticketNumber')
if ticket_number_el:
    ticket_number_el.string = ticket_data['ticket_number']

# Обновляем остальные данные
elements = {
    'validFrom': 'valid_from',
    'validUntil': 'valid_until',
    'region': 'region',
    'class': 'class',
    'priceLevel': 'price_level'
}

for html_id, data_key in elements.items():
    el = soup.find(id=html_id)
    if el and data_key in ticket_data:
        el.string = ticket_data[data_key]

# Обновляем время последнего обновления
last_updated = soup.find(id='lastUpdatedTime')
if last_updated:
    last_updated.string = ticket_data['last_updated']

# Сохраняем обновленный HTML
with open('index.html', 'w', encoding='utf-8') as f:
    f.write(str(soup))

print('index.html успешно обновлен с данными билета.')
    "
